---
layout: default
title: LIVE
permalink: /live.html
---

<div class="content-section">
  <h1 class="section-title">LIVE</h1>

  <form id="filter-form" class="filter-form">
    <div class="form-group">
      <label for="start-date"><i class="fa-solid fa-calendar-days"></i> 期間:</label>
      <div class="date-inputs">
        <input type="date" id="start-date">
        <span>～</span>
        <input type="date" id="end-date">
      </div>
    </div>
    <div class="form-group">
      <label for="theater-select"><i class="fa-solid fa-masks-theater"></i> 劇場:</label>
      <select id="theater-select">
        <option value="">すべて</option>
        <option value="神保町よしもと漫才劇場">神保町よしもと漫才劇場</option>
        <option value="渋谷よしもと漫才劇場">渋谷よしもと漫才劇場</option>
        <option value="その他">その他</option>
      </select>
    </div>
    <div class="form-buttons">
      <button type="submit">絞り込む</button>
      <button type="reset" id="reset-button">リセット</button>
    </div>
  </form>

  <div class="list-controls">
    <div class="sort-container">
      <label for="sort-select">並び順:</label>
      <select id="sort-select">
        <option value="date-asc">公演日順（昇順）</option>
        <option value="date-desc">公演日順（降順）</option>
        <option value="added-desc">追加日順（新しい順）</option>
        <option value="added-asc">追加日順（古い順）</option>
      </select>
    </div>
    <div id="item-count-display" class="item-count-display"></div>
  </div>

  <div id="live-list-container">
    <ul class="professional-live-list">
      
      {% assign today_date = "now" | date: "%Y-%m-%d" %}

      {% for live in site.data.lives %}

        {% if live.date >= today_date %}

          {% assign theater_category = "その他" %}
          {% if live.venue contains "神保町" %}
            {% assign theater_category = "神保町よしもと漫才劇場" %}
          {% elsif live.venue contains "渋谷" %}
            {% assign theater_category = "渋谷よしもと漫才劇場" %}
          {% endif %}
      
          <li class="live-list-item animate-on-scroll"
              data-index="{{ forloop.index }}"
              data-date="{{ live.date }}" 
              data-theater="{{ theater_category }}"
              data-time-start="{{ live.time_start }}">

              <a href="{{ live.url | relative_url }}" class="live-link-block">
                <div class="live-date">
                  {% assign day_of_week = live.date | date: "%w" %}
                  {% case day_of_week %}{% when "0" %}{% assign day_name = "日" %}{% when "1" %}{% assign day_name = "月" %}{% when "2" %}{% assign day_name = "火" %}{% when "3" %}{% assign day_name = "水" %}{% when "4" %}{% assign day_name = "木" %}{% when "5" %}{% assign day_name = "金" %}{% when "6" %}{% assign day_name = "土" %}{% endcase %}
                  <span class="year">{{ live.date | date: "%Y" }}</span>
                  <span class="day">{{ live.date | date: "%m.%d" }} ({{ day_name }})</span>
                </div>
        
                
                <div class="live-details-main">
                  <p class="live-title">{{ live.title }}</p>
                  <div class="live-meta">
                    <span><i class="fa-solid fa-location-dot"></i> {{ live.venue }}</span>
                    <span><i class="fa-solid fa-clock"></i> OPEN {{ live.time_open }} / START {{ live.time_start }}</span>
                  </div>
                </div>

                <div class="live-arrow-icon">
                  <i class="fa-solid fa-chevron-right"></i>
                </div>

              </a>

              {% if live.streaming_url %}
                <div class="streaming-info">
                  <a href="{{ live.streaming_url }}" class="button streaming-button" target="_blank" rel="noopener noreferrer">
                    <i class="fa-solid fa-tower-broadcast"></i> オンライン配信で見る
                  </a>
                </div>
              {% endif %}
          </li>

        {% endif %} {% endfor %} </ul>
  </div>
</div>

<script>
  const filterForm = document.getElementById('filter-form');
  const liveListContainer = document.querySelector('.professional-live-list');
  const allLiveItems = Array.from(document.querySelectorAll('.live-list-item')); 
  const sortSelect = document.getElementById('sort-select');
  const itemCountDisplay = document.getElementById('item-count-display');

  // 件数表示を更新
  function updateItemCount() {
    const visibleItems = allLiveItems.filter(item => item.style.display !== 'none');
    itemCountDisplay.textContent = `表示件数: ${visibleItems.length} 件`;
  }

  // フィルター処理
  function applyFilters() {
    const startDate = document.getElementById('start-date').value;
    const endDate = document.getElementById('end-date').value;
    const selectedTheater = document.getElementById('theater-select').value;

    allLiveItems.forEach(item => {
      const itemDate = item.dataset.date;
      const itemTheater = item.dataset.theater;

      let isVisible = true;

      if (startDate && itemDate < startDate) isVisible = false;
      if (endDate && itemDate > endDate) isVisible = false;
      if (selectedTheater && itemTheater !== selectedTheater) isVisible = false;
      
      item.style.display = isVisible ? '' : 'none';
    });

    applySorting();
    updateItemCount();
  }

  function parseDateTime(item) {
    return new Date(item.dataset.date + "T" + item.dataset.timeStart);
}

  // 並び替え処理（表示されているアイテムのみ対象）
  function applySorting() {
    const sortValue = sortSelect.value;
    const visibleItems = allLiveItems.filter(item => item.style.display !== 'none');

    let sortedItems = [...visibleItems];

    if (sortValue === 'date-asc') {
      sortedItems.sort((a, b) => parseDateTime(a) - parseDateTime(b));
    } else if (sortValue === 'date-desc') {
      sortedItems.sort((a, b) => parseDateTime(b) - parseDateTime(a));
    } else if (sortValue === 'added-asc') {
      sortedItems.sort((a, b) => a.dataset.index - b.dataset.index);
    } else if (sortValue === 'added-desc') {
      sortedItems.sort((a, b) => b.dataset.index - a.dataset.index);
    }

    sortedItems.forEach(item => liveListContainer.appendChild(item));

    updateItemCount();
  }

  // フィルターフォーム
  filterForm.addEventListener('submit', function(event) {
    event.preventDefault();
    applyFilters();
  });

  filterForm.addEventListener('reset', function() {
    setTimeout(() => {
      allLiveItems.forEach(item => {
        item.style.display = '';
      });
      applySorting(); 
      updateItemCount();
    }, 100);
  });

  // 並び替えイベント
  sortSelect.addEventListener('change', function() {
    applySorting();
  });

  // 初期ロード時
  document.addEventListener('DOMContentLoaded', () => {
    sortSelect.value = 'date-asc';
    applyFilters();
  });
</script>

